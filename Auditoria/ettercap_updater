#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20171003

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	WEB=http://ettercap.github.io/ettercap/downloads.html
	VERSION=$(curl -s $WEB|grep latest|cut -d ":" -f 2|cut -d- -f-1|sed "s/ //g")
	PRGNAM=ettercap
	echo -ne "\033]2;${PRGNAM}_updater\007"
	EXTENSION=tar.gz
	SOURCES=$PRGNAM-$VERSION.$EXTENSION
	CD=$PRGNAM-$VERSION
	DOWNLOAD=https://github.com/Ettercap/ettercap/releases/download/v$VERSION/$SOURCES    
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="libnet"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){

if [ $VERSION = 0.8.2 ]; then
echo "RnJvbSA0YWQ3Zjg1ZGMwMTIwMmUzNjM2NTlhYTQ3M2M5OTQ3MGIzZjRlMWY0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBHaWFuZnJhbmNvIENvc3RhbWFnbmEgPGNvc3RhbWFnbmFnaWFu
ZnJhbmNvQHlhaG9vLml0PgpEYXRlOiBUdWUsIDcgTWFyIDIwMTcgMjI6MDU6MzEgKzAxMDAKU3Vi
amVjdDogW1BBVENIXSBGaXggaXNzdWUgIzc4MgoKLS0tCiB1dGlscy9ldHRlcmZpbHRlci9lZl9j
b21waWxlci5jIHwgIDQgKysrLQogdXRpbHMvZXR0ZXJmaWx0ZXIvZWZfbWFpbi5jICAgICB8IDEw
ICsrKysrKystLS0KIHV0aWxzL2V0dGVyZmlsdGVyL2VmX291dHB1dC5jICAgfCAgMyArKysKIDMg
ZmlsZXMgY2hhbmdlZCwgMTMgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS91dGlscy9ldHRlcmZpbHRlci9lZl9jb21waWxlci5jIGIvdXRpbHMvZXR0ZXJmaWx0ZXIv
ZWZfY29tcGlsZXIuYwppbmRleCBkYjg3NjYzNmUuLmRkYjczYmQzMCAxMDA2NDQKLS0tIGEvdXRp
bHMvZXR0ZXJmaWx0ZXIvZWZfY29tcGlsZXIuYworKysgYi91dGlscy9ldHRlcmZpbHRlci9lZl9j
b21waWxlci5jCkBAIC0yMzksNyArMjM5LDkgQEAgc2l6ZV90IGNvbXBpbGVfdHJlZShzdHJ1Y3Qg
ZmlsdGVyX29wICoqZm9wKQogICAgc3RydWN0IGZpbHRlcl9vcCAqYXJyYXkgPSBOVUxMOwogICAg
c3RydWN0IHVuZm9sZF9lbG0gKnVlOwogCi0gICBCVUdfSUYodHJlZV9yb290ID09IE5VTEwpOwor
ICAgLy8gaW52YWxpZCBmaWxlCisgICBpZiAodHJlZV9yb290ID09IE5VTEwpCisgICAgICByZXR1
cm4gMDsKICAgCiAgICBmcHJpbnRmKHN0ZG91dCwgIiBVbmZvbGRpbmcgdGhlIG1ldGEtdHJlZSAi
KTsKICAgIGZmbHVzaChzdGRvdXQpOwpkaWZmIC0tZ2l0IGEvdXRpbHMvZXR0ZXJmaWx0ZXIvZWZf
bWFpbi5jIGIvdXRpbHMvZXR0ZXJmaWx0ZXIvZWZfbWFpbi5jCmluZGV4IGFlNDU5MTM0NC4uNDMx
MDg0YjkxIDEwMDY0NAotLS0gYS91dGlscy9ldHRlcmZpbHRlci9lZl9tYWluLmMKKysrIGIvdXRp
bHMvZXR0ZXJmaWx0ZXIvZWZfbWFpbi5jCkBAIC0zOSw3ICszOSw3IEBAIHN0cnVjdCBnbG9iYWxz
ICpnYmxzOwogCiBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogewotCisgICBpbnQg
cmV0X3ZhbHVlID0gMDsKICAgIGdsb2JhbHNfYWxsb2MoKTsKICAgIC8qIGV0dGVyZmlsdGVyIGNv
cHlyaWdodCAqLwogICAgZnByaW50ZihzdGRvdXQsICJcbiIgRUNfQ09MT1JfQk9MRCAiJXMgJXMi
IEVDX0NPTE9SX0VORCAiIGNvcHlyaWdodCAlcyAlc1xuXG4iLCAKQEAgLTg0LDggKzg0LDEyIEBA
IGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCiAgICAgICBmcHJpbnRmKHN0ZG91dCwg
IlxuXG5UaGUgc2NyaXB0IGNvbnRhaW5zIGVycm9ycy4uLlxuXG4iKTsKICAgCiAgICAvKiB3cml0
ZSB0byBmaWxlICovCi0gICBpZiAod3JpdGVfb3V0cHV0KCkgIT0gRV9TVUNDRVNTKQotICAgICAg
RkFUQUxfRVJST1IoIkNhbm5vdCB3cml0ZSBvdXRwdXQgZmlsZSAoJXMpIiwgR0JMX09QVElPTlMt
Pm91dHB1dF9maWxlKTsKKyAgIHJldF92YWx1ZSA9IHdyaXRlX291dHB1dCgpOworICAgaWYgKHJl
dF92YWx1ZSA9PSAtRV9OT1RIQU5ETEVEKQorICAgICAgRkFUQUxfRVJST1IoIkNhbm5vdCB3cml0
ZSBvdXRwdXQgZmlsZSAoJXMpOiB0aGUgZmlsdGVyIGlzIG5vdCBjb3JyZWN0bHkgaGFuZGxlZC4i
LCBHQkxfT1BUSU9OUy0+b3V0cHV0X2ZpbGUpOworICAgZWxzZSBpZiAocmV0X3ZhbHVlID09IC1F
X0lOVkFMSUQpCisgICAgICBGQVRBTF9FUlJPUigiQ2Fubm90IHdyaXRlIG91dHB1dCBmaWxlICgl
cyk6IHRoZSBmaWx0ZXIgZm9ybWF0IGlzIG5vdCBjb3JyZWN0LiAiLCBHQkxfT1BUSU9OUy0+b3V0
cHV0X2ZpbGUpOworCiAgICBnbG9iYWxzX2ZyZWUoKTsKICAgIHJldHVybiAwOwogfQpkaWZmIC0t
Z2l0IGEvdXRpbHMvZXR0ZXJmaWx0ZXIvZWZfb3V0cHV0LmMgYi91dGlscy9ldHRlcmZpbHRlci9l
Zl9vdXRwdXQuYwppbmRleCA1YWU1OTE5MDQuLmZjZjE5ZjAxMCAxMDA2NDQKLS0tIGEvdXRpbHMv
ZXR0ZXJmaWx0ZXIvZWZfb3V0cHV0LmMKKysrIGIvdXRpbHMvZXR0ZXJmaWx0ZXIvZWZfb3V0cHV0
LmMKQEAgLTUxLDYgKzUxLDkgQEAgaW50IHdyaXRlX291dHB1dCh2b2lkKQogICAgaWYgKGZvcCA9
PSBOVUxMKQogICAgICAgcmV0dXJuIC1FX05PVEhBTkRMRUQ7CiAKKyAgIGlmIChuaW5zdCA9PSAw
KQorICAgICAgcmV0dXJuIC1FX0lOVkFMSUQ7CisKICAgIC8qIGNyZWF0ZSB0aGUgZmlsZSAqLwog
ICAgZmQgPSBvcGVuKEdCTF9PUFRJT05TLT5vdXRwdXRfZmlsZSwgT19DUkVBVCB8IE9fUkRXUiB8
IE9fVFJVTkMgfCBPX0JJTkFSWSwgMDY0NCk7CiAgICBPTl9FUlJPUihmZCwgLTEsICJDYW4ndCBj
cmVhdGUgZmlsZSAlcyIsIEdCTF9PUFRJT05TLT5vdXRwdXRfZmlsZSk7Cg==
" | base64 -d > $TMP/CVE-2017-6430.patch
patch -p1 -i $TMP/CVE-2017-6430.patch

echo "RnJvbSBkMTRkMjU1OGRhMTRhMzNhYmY3YmFhYjI4OTU3NDg4YTc1ZDE2YWYxIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBBbGV4YW5kZXIgS29lcHBlIDxmb3JtYXRfY0BvbmxpbmUuZGU+
CkRhdGU6IFRodSwgMSBKdW4gMjAxNyAwODo1NjoyMyArMDIwMApTdWJqZWN0OiBbUEFUQ0ggMS80
XSBBZGQgQVNBTiBjb21waWxlciBmbGFncyBpbiBERUJVRyBidWlsZCB0eXBlCgotLS0KIENNYWtl
TGlzdHMudHh0IHwgMiArLQogMSBmaWxlIGNoYW5nZWQsIDEgaW5zZXJ0aW9uKCspLCAxIGRlbGV0
aW9uKC0pCgpkaWZmIC0tZ2l0IGEvQ01ha2VMaXN0cy50eHQgYi9DTWFrZUxpc3RzLnR4dAppbmRl
eCA5MDA1MDU5MGYuLjhlODIzNjY5YyAxMDA2NDQKLS0tIGEvQ01ha2VMaXN0cy50eHQKKysrIGIv
Q01ha2VMaXN0cy50eHQKQEAgLTEyNiw3ICsxMjYsNyBAQCBpZihOT1QgRElTQUJMRV9SUEFUSCkK
ICAgc2V0KENNQUtFX0lOU1RBTExfUlBBVEhfVVNFX0xJTktfUEFUSCBUUlVFKQogICBzZXQoQ01B
S0VfTUFDT1NYX1JQQVRIIDEpCiBlbmRpZihOT1QgRElTQUJMRV9SUEFUSCkKLXNldChDTUFLRV9D
X0ZMQUdTX0RFQlVHICItTzAgLWdnZGIzIC1EREVCVUcgLVdhbGwgLVduby1wb2ludGVyLXNpZ24g
LURfRk9SVElGWV9TT1VSQ0U9MiAtV2Zvcm1hdCAtV2Zvcm1hdC1zZWN1cml0eSAtV2Vycm9yPWZv
cm1hdC1zZWN1cml0eSAtV2V4dHJhIC1XcmVkdW5kYW50LWRlY2xzIiBDQUNIRSBTVFJJTkcgIiIg
Rk9SQ0UpCitzZXQoQ01BS0VfQ19GTEFHU19ERUJVRyAiLU8wIC1nZ2RiMyAtRERFQlVHIC1XYWxs
IC1Xbm8tcG9pbnRlci1zaWduIC1EX0ZPUlRJRllfU09VUkNFPTIgLVdmb3JtYXQgLVdmb3JtYXQt
c2VjdXJpdHkgLVdlcnJvcj1mb3JtYXQtc2VjdXJpdHkgLVdleHRyYSAtV3JlZHVuZGFudC1kZWNs
cyAtZnNhbml0aXplPWFkZHJlc3MgLWZuby1vbWl0LWZyYW1lLXBvaW50ZXIiIENBQ0hFIFNUUklO
RyAiIiBGT1JDRSkKIHNldChDTUFLRV9DX0ZMQUdTX1JFTEVBU0UgIi1PMiAtdyAtRF9GT1JUSUZZ
X1NPVVJDRT0yIiBDQUNIRSBTVFJJTkcgIiIgRk9SQ0UpCiAKIGlmKE9TX0RBUldJTikKCkZyb20g
MDQ0MDUxZDMwMmRhNzNlMTZiMDU3N2ViNzk3Y2Q0MmFmZmJhMjdlNSBNb24gU2VwIDE3IDAwOjAw
OjAwIDIwMDEKRnJvbTogQWxleGFuZGVyIEtvZXBwZSA8Zm9ybWF0X2NAb25saW5lLmRlPgpEYXRl
OiBUaHUsIDEgSnVuIDIwMTcgMDg6NTY6NTcgKzAyMDAKU3ViamVjdDogW1BBVENIIDIvNF0gZml4
IGJ1ZmZlciBvdmVyLSAvIHVuZGVyZmxvdyBjb25kaXRpb25zCgotLS0KIGluY2x1ZGUvZWNfc3Ry
aW5ncy5oIHwgIDIgKy0KIHNyYy9lY19zdHJpbmdzLmMgICAgIHwgMjUgKysrKysrKysrKysrKysr
LS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxNiBpbnNlcnRpb25zKCspLCAxMSBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9pbmNsdWRlL2VjX3N0cmluZ3MuaCBiL2luY2x1ZGUvZWNfc3Ry
aW5ncy5oCmluZGV4IGY3OTE3MzlkYS4uOWFkMjQ1ZWYzIDEwMDY0NAotLS0gYS9pbmNsdWRlL2Vj
X3N0cmluZ3MuaAorKysgYi9pbmNsdWRlL2VjX3N0cmluZ3MuaApAQCAtNDMsNyArNDMsNyBAQAog
CiBFQ19BUElfRVhURVJOIGludCBtYXRjaF9wYXR0ZXJuKGNvbnN0IGNoYXIgKnMsIGNvbnN0IGNo
YXIgKnBhdHRlcm4pOwogRUNfQVBJX0VYVEVSTiBpbnQgYmFzZTY0X2RlY29kZShjaGFyICpidWZw
bGFpbiwgY29uc3QgY2hhciAqYnVmY29kZWQpOwotRUNfQVBJX0VYVEVSTiBpbnQgc3RyZXNjYXBl
KGNoYXIgKmRzdCwgY2hhciAqc3JjKTsKK0VDX0FQSV9FWFRFUk4gaW50IHN0cmVzY2FwZShjaGFy
ICpkc3QsIGNoYXIgKnNyYywgc2l6ZV90IGxlbik7CiBFQ19BUElfRVhURVJOIGludCBzdHJfcmVw
bGFjZShjaGFyICoqdGV4dCwgY29uc3QgY2hhciAqcywgY29uc3QgY2hhciAqZCk7ICAgCiBFQ19B
UElfRVhURVJOIHNpemVfdCBzdHJsZW5fdXRmOChjb25zdCBjaGFyICpzKTsKIEVDX0FQSV9FWFRF
Uk4gY2hhciAqIGVjX3N0cnRvayhjaGFyICpzLCBjb25zdCBjaGFyICpkZWxpbSwgY2hhciAqKnB0
cnB0cik7CmRpZmYgLS1naXQgYS9zcmMvZWNfc3RyaW5ncy5jIGIvc3JjL2VjX3N0cmluZ3MuYwpp
bmRleCA1MzU4Mzg1MWEuLjIxYjcxOTI2YyAxMDA2NDQKLS0tIGEvc3JjL2VjX3N0cmluZ3MuYwor
KysgYi9zcmMvZWNfc3RyaW5ncy5jCkBAIC0xNjcsMTMgKzE2NywxNCBAQCBzdGF0aWMgaW50IGhl
eHRvaW50KGludCBjKQogLyogCiAgKiBjb252ZXJ0IHRoZSBlc2NhcGVkIHN0cmluZyBpbnRvIGEg
YmluYXJ5IG9uZQogICovCi1pbnQgc3RyZXNjYXBlKGNoYXIgKmRzdCwgY2hhciAqc3JjKQoraW50
IHN0cmVzY2FwZShjaGFyICpkc3QsIGNoYXIgKnNyYywgc2l6ZV90IGxlbikKIHsKICAgIGNoYXIg
ICpvbGRkc3QgPSBkc3Q7CisgICBjaGFyICAqb2xkc3JjID0gc3JjOwogICAgaW50ICAgYzsKICAg
IGludCAgIHZhbDsKIAotICAgd2hpbGUgKChjID0gKnNyYysrKSAhPSAnXDAnKSB7CisgICB3aGls
ZSAoKGMgPSAqc3JjKyspICE9ICdcMCcgJiYgKHNpemVfdCkoc3JjIC0gb2xkc3JjKSA8PSBsZW4p
IHsKICAgICAgIGlmIChjID09ICdcXCcpIHsKICAgICAgICAgIHN3aXRjaCAoKGMgPSAqc3JjKysp
KSB7CiAgICAgICAgICAgICBjYXNlICdcMCc6CkBAIC0yMTgsOSArMjE5LDExIEBAIGludCBzdHJl
c2NhcGUoY2hhciAqZHN0LCBjaGFyICpzcmMpCiAgICAgICAgICAgICAgICAgICBpZiAoYyA+PSAn
MCcgJiYgYyA8PSAnNycpCiAgICAgICAgICAgICAgICAgICAgICB2YWwgPSAodmFsIDw8IDMpIHwg
KGMgLSAnMCcpOwogICAgICAgICAgICAgICAgICAgZWxzZSAKLSAgICAgICAgICAgICAgICAgICAg
IC0tc3JjOworICAgICAgICAgICAgICAgICAgICAgaWYgKHNyYyA+IG9sZHNyYykgLyogcHJvdGVj
dCBhZ2FpbnN0IGJ1ZmZlciB1bmRlcmZsb3cgKi8KKyAgICAgICAgICAgICAgICAgICAgICAgIC0t
c3JjOwogICAgICAgICAgICAgICAgfSBlbHNlIAotICAgICAgICAgICAgICAgICAgLS1zcmM7Cisg
ICAgICAgICAgICAgICAgICBpZiAoc3JjID4gb2xkc3JjKSAvKiBwcm90ZWN0IGFnYWluc3QgYnVm
ZmVyIHVuZGVyZmxvdyAqLworICAgICAgICAgICAgICAgICAgICAgLS1zcmM7CiAgICAgICAgICAg
ICAgICAqZHN0KysgPSAoY2hhcikgdmFsOwogICAgICAgICAgICAgICAgYnJlYWs7CiAKQEAgLTIz
MiwxNSArMjM1LDE3IEBAIGludCBzdHJlc2NhcGUoY2hhciAqZHN0LCBjaGFyICpzcmMpCiAgICAg
ICAgICAgICAgICAgICAgICAgIGMgPSBoZXh0b2ludCgqc3JjKyspOwogICAgICAgICAgICAgICAg
ICAgICAgICBpZiAoYyA+PSAwKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gKHZh
bCA8PCA0KSArIGM7Ci0gICAgICAgICAgICAgICAgICAgICAgIGVsc2UgCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgIC0tc3JjOwotICAgICAgICAgICAgICAgfSBlbHNlIAotICAgICAgICAgICAg
ICAgICAgLS1zcmM7CisgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNyYyA+IG9sZHNy
YykgLyogcHJvdGVjdCBhZ2FpbnN0IGJ1ZmZlciB1bmRlcmZsb3cgKi8KKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgLS1zcmM7CisgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNyYyA+IG9s
ZHNyYykgLyogcHJvdGVjdCBhZ2FpbnN0IGJ1ZmZlciB1bmRlcmZsb3cgKi8KKyAgICAgICAgICAg
ICAgICAgICAgIC0tc3JjOwogICAgICAgICAgICAgICAgKmRzdCsrID0gKGNoYXIpIHZhbDsKICAg
ICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQotICAgICAgfSBlbHNlIGlmIChjID09IDgg
fHwgYyA9PSAyNjMpICAvKiB0aGUgYmFja3NwYWNlICovCi0gICAgICAgICBkc3QtLTsKKyAgICAg
IH0gZWxzZSBpZiAoYyA9PSA4IHx8IGMgPT0gMjYzKSB7ICAvKiB0aGUgYmFja3NwYWNlICovCisg
ICAgICAgICBpZiAoZHN0ID4gb2xkc3JjKSAvKiBwcm90ZWN0IGFnYWluc3QgYnVmZmVyIHVuZGVy
ZmxvdyAqLworICAgICAgICAgICAgZHN0LS07CisgICAgICB9CiAgICAgICBlbHNlCiAgICAgICAg
ICAqZHN0KysgPSAoY2hhcikgYzsKICAgIH0KCkZyb20gMTk3MDZjZjUzYjE4OWZiYzk5Njc5MWNk
YjRiMGQ5YTFmMGZlYWU1ZiBNb24gU2VwIDE3IDAwOjAwOjAwIDIwMDEKRnJvbTogQWxleGFuZGVy
IEtvZXBwZSA8Zm9ybWF0X2NAb25saW5lLmRlPgpEYXRlOiBUaHUsIDEgSnVuIDIwMTcgMDg6NTc6
NTQgKzAyMDAKU3ViamVjdDogW1BBVENIIDMvNF0gYWRhcHQgY2FsbHMgb2Ygc3RyZXNjYXBlKCkg
YWRkaW5nIHN0cmxlbgoKLS0tCiBzcmMvZWNfZW5jcnlwdGlvbi5jICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB8ICAyICstCiBzcmMvaW50ZXJmYWNlcy9jdXJzZXMvZWNfY3Vyc2VzX3Zp
ZXdfY29ubmVjdGlvbnMuYyB8ICAyICstCiBzcmMvaW50ZXJmYWNlcy9ndGsvZWNfZ3RrX3ZpZXdf
Y29ubmVjdGlvbnMuYyAgICAgICB8ICAyICstCiB1dGlscy9ldHRlcmZpbHRlci9lZl9lbmNvZGUu
YyAgICAgICAgICAgICAgICAgICAgICB8IDE4ICsrKysrKysrKysrKy0tLS0tLQogNCBmaWxlcyBj
aGFuZ2VkLCAxNSBpbnNlcnRpb25zKCspLCA5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Ny
Yy9lY19lbmNyeXB0aW9uLmMgYi9zcmMvZWNfZW5jcnlwdGlvbi5jCmluZGV4IDZjMDI1MjljMS4u
M2Q1MDU2MDMwIDEwMDY0NAotLS0gYS9zcmMvZWNfZW5jcnlwdGlvbi5jCisrKyBiL3NyYy9lY19l
bmNyeXB0aW9uLmMKQEAgLTIxOCw3ICsyMTgsNyBAQCBpbnQgc2V0X3dlcF9rZXkoY2hhciAqc3Ry
aW5nKQogCiAgICBpZiAodHlwZSA9PSAncycpIHsKICAgICAgIC8qIGVzY2FwZSB0aGUgc3RyaW5n
IGFuZCBjaGVjayBpdHMgbGVuZ3RoICovCi0gICAgICBpZiAoc3RyZXNjYXBlKChjaGFyICopdG1w
X3drZXksIHApICE9IChpbnQpdG1wX3drZXlfbGVuKQorICAgICAgaWYgKHN0cmVzY2FwZSgoY2hh
ciAqKXRtcF93a2V5LCBwLCBzdHJsZW4odG1wX3drZXkpKzEpICE9IChpbnQpdG1wX3drZXlfbGVu
KQogICAgIAkgIFNFTUlGQVRBTF9FUlJPUigiU3BlY2lmaWVkIFdFUCBrZXkgbGVuZ3RoIGRvZXMg
bm90IG1hdGNoIHRoZSBnaXZlbiBzdHJpbmciKTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PSAncCcp
IHsKICAgICAgIC8qIGNyZWF0ZSB0aGUga2V5IGZyb20gdGhlIHBhc3NwaHJhc2UgKi8KZGlmZiAt
LWdpdCBhL3NyYy9pbnRlcmZhY2VzL2N1cnNlcy9lY19jdXJzZXNfdmlld19jb25uZWN0aW9ucy5j
IGIvc3JjL2ludGVyZmFjZXMvY3Vyc2VzL2VjX2N1cnNlc192aWV3X2Nvbm5lY3Rpb25zLmMKaW5k
ZXggZmI1MjMzMWNmLi4wMTFjMGVkZjcgMTAwNjQ0Ci0tLSBhL3NyYy9pbnRlcmZhY2VzL2N1cnNl
cy9lY19jdXJzZXNfdmlld19jb25uZWN0aW9ucy5jCisrKyBiL3NyYy9pbnRlcmZhY2VzL2N1cnNl
cy9lY19jdXJzZXNfdmlld19jb25uZWN0aW9ucy5jCkBAIC02MTQsNyArNjE0LDcgQEAgc3RhdGlj
IHZvaWQgaW5qZWN0X3VzZXIodm9pZCkKICAgIHNpemVfdCBsZW47CiAKICAgIC8qIGVzY2FwZSB0
aGUgc2VxdW5jZXMgaW4gdGhlIGJ1ZmZlciAqLwotICAgbGVuID0gc3RyZXNjYXBlKChjaGFyKilp
bmplY3RidWYsIChjaGFyKilpbmplY3RidWYpOworICAgbGVuID0gc3RyZXNjYXBlKChjaGFyKilp
bmplY3RidWYsIChjaGFyKilpbmplY3RidWYsIHN0cmxlbihpbmplY3RidWYpKzEpOwogICAgCiAg
ICAvKiBjaGVjayB3aGVyZSB0byBpbmplY3QgKi8KICAgIGlmICh3ZGdfYzEtPmZsYWdzICYgV0RH
X09CSl9GT0NVU0VEKSB7CmRpZmYgLS1naXQgYS9zcmMvaW50ZXJmYWNlcy9ndGsvZWNfZ3RrX3Zp
ZXdfY29ubmVjdGlvbnMuYyBiL3NyYy9pbnRlcmZhY2VzL2d0ay9lY19ndGtfdmlld19jb25uZWN0
aW9ucy5jCmluZGV4IGZhN2RmZGM1OC4uYjU1ZTE3NTVhIDEwMDY0NAotLS0gYS9zcmMvaW50ZXJm
YWNlcy9ndGsvZWNfZ3RrX3ZpZXdfY29ubmVjdGlvbnMuYworKysgYi9zcmMvaW50ZXJmYWNlcy9n
dGsvZWNfZ3RrX3ZpZXdfY29ubmVjdGlvbnMuYwpAQCAtMTYyNyw3ICsxNjI3LDcgQEAgc3RhdGlj
IHZvaWQgZ3RrdWlfaW5qZWN0X3VzZXIoaW50IHNpZGUpCiAgICBzaXplX3QgbGVuOwogICAgIAog
ICAgLyogZXNjYXBlIHRoZSBzZXF1bmNlcyBpbiB0aGUgYnVmZmVyICovCi0gICBsZW4gPSBzdHJl
c2NhcGUoaW5qZWN0YnVmLCBpbmplY3RidWYpOworICAgbGVuID0gc3RyZXNjYXBlKGluamVjdGJ1
ZiwgaW5qZWN0YnVmLCBzdHJsZW4oaW5qZWN0YnVmKSsxKTsKIAogICAgLyogY2hlY2sgd2hlcmUg
dG8gaW5qZWN0ICovCiAgICBpZiAoc2lkZSA9PSAxIHx8IHNpZGUgPT0gMikgewpkaWZmIC0tZ2l0
IGEvdXRpbHMvZXR0ZXJmaWx0ZXIvZWZfZW5jb2RlLmMgYi91dGlscy9ldHRlcmZpbHRlci9lZl9l
bmNvZGUuYwppbmRleCBkNGI5MTEwY2QuLjdlMzU5ZTA2MiAxMDA2NDQKLS0tIGEvdXRpbHMvZXR0
ZXJmaWx0ZXIvZWZfZW5jb2RlLmMKKysrIGIvdXRpbHMvZXR0ZXJmaWx0ZXIvZWZfZW5jb2RlLmMK
QEAgLTEzNiw3ICsxMzYsOCBAQCBpbnQgZW5jb2RlX2NvbnN0KGNoYXIgKnN0cmluZywgc3RydWN0
IGZpbHRlcl9vcCAqZm9wKQogICAgICAgZm9wLT5vcC50ZXN0LnN0cmluZyA9ICh1X2NoYXIqKXN0
cmR1cChzdHJpbmcgKyAxKTsKICAgICAgICAgIAogICAgICAgLyogZXNjYXBlIGl0IGluIHRoZSBz
dHJ1Y3R1cmUgKi8KLSAgICAgIGZvcC0+b3AudGVzdC5zbGVuID0gc3RyZXNjYXBlKChjaGFyKilm
b3AtPm9wLnRlc3Quc3RyaW5nLCAoY2hhciopZm9wLT5vcC50ZXN0LnN0cmluZyk7CisgICAgICBm
b3AtPm9wLnRlc3Quc2xlbiA9IHN0cmVzY2FwZSgoY2hhciopZm9wLT5vcC50ZXN0LnN0cmluZywg
CisgICAgICAgICAgICAoY2hhciopZm9wLT5vcC50ZXN0LnN0cmluZywgc3RybGVuKGZvcC0+b3Au
dGVzdC5zdHJpbmcpKzEpOwogICAgICAKICAgICAgIHJldHVybiBFX1NVQ0NFU1M7CiAgICAgICAK
QEAgLTE4NCw3ICsxODUsOCBAQCBpbnQgZW5jb2RlX2Z1bmN0aW9uKGNoYXIgKnN0cmluZywgc3Ry
dWN0IGZpbHRlcl9vcCAqZm9wKQogICAgICAgICAgICAgZm9wLT5vcGNvZGUgPSBGT1BfRlVOQzsK
ICAgICAgICAgICAgIGZvcC0+b3AuZnVuYy5vcCA9IEZGVU5DX1NFQVJDSDsKICAgICAgICAgICAg
IGZvcC0+b3AuZnVuYy5zdHJpbmcgPSAodV9jaGFyKilzdHJkdXAoZGVjX2FyZ3NbMV0pOwotICAg
ICAgICAgICAgZm9wLT5vcC5mdW5jLnNsZW4gPSBzdHJlc2NhcGUoKGNoYXIqKWZvcC0+b3AuZnVu
Yy5zdHJpbmcsIChjaGFyKilmb3AtPm9wLmZ1bmMuc3RyaW5nKTsKKyAgICAgICAgICAgIGZvcC0+
b3AuZnVuYy5zbGVuID0gc3RyZXNjYXBlKChjaGFyKilmb3AtPm9wLmZ1bmMuc3RyaW5nLCAKKyAg
ICAgICAgICAgICAgICAgIChjaGFyKilmb3AtPm9wLmZ1bmMuc3RyaW5nLCBzdHJsZW4oZm9wLT5v
cC5mdW5jLnN0cmluZykrMSk7CiAgICAgICAgICAgICByZXQgPSBFX1NVQ0NFU1M7CiAgICAgICAg
ICB9IGVsc2UKICAgICAgICAgICAgIFNDUklQVF9FUlJPUigiVW5rbm93biBvZmZzZXQgJXMgIiwg
ZGVjX2FyZ3NbMF0pOwpAQCAtMjAyLDcgKzIwNCw4IEBAIGludCBlbmNvZGVfZnVuY3Rpb24oY2hh
ciAqc3RyaW5nLCBzdHJ1Y3QgZmlsdGVyX29wICpmb3ApCiAgICAgICAgICAgICBmb3AtPm9wY29k
ZSA9IEZPUF9GVU5DOwogICAgICAgICAgICAgZm9wLT5vcC5mdW5jLm9wID0gRkZVTkNfUkVHRVg7
CiAgICAgICAgICAgICBmb3AtPm9wLmZ1bmMuc3RyaW5nID0gKHVfY2hhciopc3RyZHVwKGRlY19h
cmdzWzFdKTsKLSAgICAgICAgICAgIGZvcC0+b3AuZnVuYy5zbGVuID0gc3RyZXNjYXBlKChjaGFy
Kilmb3AtPm9wLmZ1bmMuc3RyaW5nLCAoY2hhciopZm9wLT5vcC5mdW5jLnN0cmluZyk7CisgICAg
ICAgICAgICBmb3AtPm9wLmZ1bmMuc2xlbiA9IHN0cmVzY2FwZSgoY2hhciopZm9wLT5vcC5mdW5j
LnN0cmluZywgCisgICAgICAgICAgICAgICAgICAoY2hhciopZm9wLT5vcC5mdW5jLnN0cmluZywg
c3RybGVuKGZvcC0+b3AuZnVuYy5zdHJpbmcpKzEpOwogICAgICAgICAgICAgcmV0ID0gRV9TVUND
RVNTOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICBTQ1JJUFRfRVJST1IoIlVua25vd24g
b2Zmc2V0ICVzICIsIGRlY19hcmdzWzBdKTsKQEAgLTI3Miw5ICsyNzUsMTEgQEAgaW50IGVuY29k
ZV9mdW5jdGlvbihjaGFyICpzdHJpbmcsIHN0cnVjdCBmaWx0ZXJfb3AgKmZvcCkKICAgICAgICAg
IC8qIHJlcGxhY2UgYWx3YXlzIG9wZXJhdGUgYXQgREFUQSBsZXZlbCAqLwogICAgICAgICAgZm9w
LT5vcC5mdW5jLmxldmVsID0gNTsKICAgICAgICAgIGZvcC0+b3AuZnVuYy5zdHJpbmcgPSAodV9j
aGFyKilzdHJkdXAoZGVjX2FyZ3NbMF0pOwotICAgICAgICAgZm9wLT5vcC5mdW5jLnNsZW4gPSBz
dHJlc2NhcGUoKGNoYXIqKWZvcC0+b3AuZnVuYy5zdHJpbmcsIChjaGFyKilmb3AtPm9wLmZ1bmMu
c3RyaW5nKTsKKyAgICAgICAgIGZvcC0+b3AuZnVuYy5zbGVuID0gc3RyZXNjYXBlKChjaGFyKilm
b3AtPm9wLmZ1bmMuc3RyaW5nLCAKKyAgICAgICAgICAgICAgIChjaGFyKilmb3AtPm9wLmZ1bmMu
c3RyaW5nLCBzdHJsZW4oZm9wLT5vcC5mdW5jLnN0cmluZykrMSk7CiAgICAgICAgICBmb3AtPm9w
LmZ1bmMucmVwbGFjZSA9ICh1X2NoYXIqKXN0cmR1cChkZWNfYXJnc1sxXSk7Ci0gICAgICAgICBm
b3AtPm9wLmZ1bmMucmxlbiA9IHN0cmVzY2FwZSgoY2hhciopZm9wLT5vcC5mdW5jLnJlcGxhY2Us
IChjaGFyKilmb3AtPm9wLmZ1bmMucmVwbGFjZSk7CisgICAgICAgICBmb3AtPm9wLmZ1bmMucmxl
biA9IHN0cmVzY2FwZSgoY2hhciopZm9wLT5vcC5mdW5jLnJlcGxhY2UsIAorICAgICAgICAgICAg
ICAgKGNoYXIqKWZvcC0+b3AuZnVuYy5yZXBsYWNlLCBzdHJsZW4oZm9wLT5vcC5mdW5jLnJlcGxh
Y2UpKzEpOwogICAgICAgICAgcmV0ID0gRV9TVUNDRVNTOwogICAgICAgfSBlbHNlCiAgICAgICAg
ICBTQ1JJUFRfRVJST1IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGZ1bmN0aW9uIFwi
JXNcIiAiLCBuYW1lKTsKQEAgLTMyOCw3ICszMzMsOCBAQCBpbnQgZW5jb2RlX2Z1bmN0aW9uKGNo
YXIgKnN0cmluZywgc3RydWN0IGZpbHRlcl9vcCAqZm9wKQogICAgICAgaWYgKG5hcmdzID09IDEp
IHsKICAgICAgICAgIGZvcC0+b3AuZnVuYy5vcCA9IEZGVU5DX01TRzsKICAgICAgICAgIGZvcC0+
b3AuZnVuYy5zdHJpbmcgPSAodV9jaGFyKilzdHJkdXAoZGVjX2FyZ3NbMF0pOwotICAgICAgICAg
Zm9wLT5vcC5mdW5jLnNsZW4gPSBzdHJlc2NhcGUoKGNoYXIqKWZvcC0+b3AuZnVuYy5zdHJpbmcs
IChjaGFyKilmb3AtPm9wLmZ1bmMuc3RyaW5nKTsKKyAgICAgICAgIGZvcC0+b3AuZnVuYy5zbGVu
ID0gc3RyZXNjYXBlKChjaGFyKilmb3AtPm9wLmZ1bmMuc3RyaW5nLCAKKyAgICAgICAgICAgICAg
IChjaGFyKilmb3AtPm9wLmZ1bmMuc3RyaW5nLCBzdHJsZW4oZm9wLT5vcC5mdW5jLnN0cmluZykr
MSk7CiAgICAgICAgICByZXQgPSBFX1NVQ0NFU1M7CiAgICAgICB9IGVsc2UKICAgICAgICAgIFND
UklQVF9FUlJPUigiV3JvbmcgbnVtYmVyIG9mIGFyZ3VtZW50cyBmb3IgZnVuY3Rpb24gXCIlc1wi
ICIsIG5hbWUpOwoKRnJvbSBiMDA1ZDU1ZDRlYWU0NDRjNWJlMTRlYjc5MmI1MDY1N2ExNGM3YjFk
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBBbGV4YW5kZXIgS29lcHBlIDxmb3JtYXRf
Y0BvbmxpbmUuZGU+CkRhdGU6IFN1biwgNCBKdW4gMjAxNyAwODowOTowNCArMDIwMApTdWJqZWN0
OiBbUEFUQ0ggNC80XSBPbmx5IGFkZCBBU0FOIGZsYWdzIGRlcGVkaW5nIG9uIGNvbXBpbGVyIHZl
cnNpb24KCi0tLQogQ01ha2VMaXN0cy50eHQgfCAyMiArKysrKysrKysrKysrKysrKysrKystCiAx
IGZpbGUgY2hhbmdlZCwgMjEgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdp
dCBhL0NNYWtlTGlzdHMudHh0IGIvQ01ha2VMaXN0cy50eHQKaW5kZXggOGU4MjM2NjljLi44Zjdj
N2MzNjggMTAwNjQ0Ci0tLSBhL0NNYWtlTGlzdHMudHh0CisrKyBiL0NNYWtlTGlzdHMudHh0CkBA
IC0xMjYsNyArMTI2LDI3IEBAIGlmKE5PVCBESVNBQkxFX1JQQVRIKQogICBzZXQoQ01BS0VfSU5T
VEFMTF9SUEFUSF9VU0VfTElOS19QQVRIIFRSVUUpCiAgIHNldChDTUFLRV9NQUNPU1hfUlBBVEgg
MSkKIGVuZGlmKE5PVCBESVNBQkxFX1JQQVRIKQotc2V0KENNQUtFX0NfRkxBR1NfREVCVUcgIi1P
MCAtZ2dkYjMgLURERUJVRyAtV2FsbCAtV25vLXBvaW50ZXItc2lnbiAtRF9GT1JUSUZZX1NPVVJD
RT0yIC1XZm9ybWF0IC1XZm9ybWF0LXNlY3VyaXR5IC1XZXJyb3I9Zm9ybWF0LXNlY3VyaXR5IC1X
ZXh0cmEgLVdyZWR1bmRhbnQtZGVjbHMgLWZzYW5pdGl6ZT1hZGRyZXNzIC1mbm8tb21pdC1mcmFt
ZS1wb2ludGVyIiBDQUNIRSBTVFJJTkcgIiIgRk9SQ0UpCisKKyMgc2V0IGdlbmVyYWwgYnVpbGQg
ZmxhZ3MgZm9yIGRlYnVnIGJ1aWxkLXR5cGUKK3NldChDTUFLRV9DX0ZMQUdTX0RFQlVHICItTzAg
LWdnZGIzIC1EREVCVUcgLVdhbGwgLVduby1wb2ludGVyLXNpZ24gLURfRk9SVElGWV9TT1VSQ0U9
MiAtV2Zvcm1hdCAtV2Zvcm1hdC1zZWN1cml0eSAtV2Vycm9yPWZvcm1hdC1zZWN1cml0eSAtV2V4
dHJhIC1XcmVkdW5kYW50LWRlY2xzIiBDQUNIRSBTVFJJTkcgIiIgRk9SQ0UpCisjIGFwcGVuZCBB
U0FOIGJ1aWxkIGZsYWdzIGlmIGNvbXBpbGVyIHZlcnNpb24gaGFzIHN1cHBvcnQKK2lmICgiJHtD
TUFLRV9DX0NPTVBJTEVSX0lEfSIgU1RSRVFVQUwgIkdOVSIpCisgICBpZiAoQ01BS0VfQ19DT01Q
SUxFUl9WRVJTSU9OIFZFUlNJT05fR1JFQVRFUiA0LjgpCisgICAgICBzZXQoQ01BS0VfQ19GTEFH
U19ERUJVRyAiJHtDTUFLRV9DX0ZMQUdTX0RFQlVHfSAtZnNhbml0aXplPWFkZHJlc3MgLWZuby1v
bWl0LWZyYW1lLXBvaW50ZXIiIENBQ0hFIFNUUklORyAiIiBGT1JDRSkKKyAgICAgIG1lc3NhZ2Uo
IkJ1aWxkaW5nIHdpdGggQVNBTiBzdXBwb3J0IChHTlUgY29tcGlsZXIpIikKKyAgIGVsc2UgKENN
QUtFX0NfQ09NUElMRVJfVkVSU0lPTiBWRVJTSU9OX0dSRUFURVIgNC44KQorICAgICAgbWVzc2Fn
ZSgiQnVpbGRpbmcgd2l0aG91dCBBU0FOIHN1cHBvcnQgKEdOVSBjb21waWxlcikiKQorICAgZW5k
aWYgKENNQUtFX0NfQ09NUElMRVJfVkVSU0lPTiBWRVJTSU9OX0dSRUFURVIgNC44KQorZWxzZWlm
ICgiJHtDTUFLRV9DX0NPTVBJTEVSX0lEfSIgU1RSRVFVQUwgIkNsYW5nIikKKyAgIGlmIChDTUFL
RV9DX0NPTVBJTEVSX1ZFUlNJT04gVkVSU0lPTl9HUkVBVEVSIDMuMSkKKyAgICAgIHNldChDTUFL
RV9DX0ZMQUdTX0RFQlVHICIke0NNQUtFX0NfRkxBR1NfREVCVUd9IC1mc2FuaXRpemU9YWRkcmVz
cyAtZm5vLW9taXQtZnJhbWUtcG9pbnRlciIgQ0FDSEUgU1RSSU5HICIiIEZPUkNFKQorICAgICAg
bWVzc2FnZSgiQnVpbGRpbmcgd2l0aCBBU0FOIHN1cHBvcnQgKENsYW5nIGNvbXBpbGVyKSIpCisg
ICBlbHNlaWYgKENNQUtFX0NfQ09NUElMRVJfVkVSU0lPTiBWRVJTSU9OX0dSRUFURVIgMy4xKQor
ICAgICAgbWVzc2FnZSgiQnVpbGRpbmcgd2l0aG91dCBBU0FOIHN1cHBvcnQgKENsYW5nIGNvbXBp
bGVyKSIpCisgICBlbmRpZiAoQ01BS0VfQ19DT01QSUxFUl9WRVJTSU9OIFZFUlNJT05fR1JFQVRF
UiAzLjEpCitlbmRpZiAoIiR7Q01BS0VfQ19DT01QSUxFUl9JRH0iIFNUUkVRVUFMICJHTlUiKQor
CisjIHNldCBidWlsZCBmbGFncyBmb3IgcmVsZWFzZSBidWlsZC10eXBlCiBzZXQoQ01BS0VfQ19G
TEFHU19SRUxFQVNFICItTzIgLXcgLURfRk9SVElGWV9TT1VSQ0U9MiIgQ0FDSEUgU1RSSU5HICIi
IEZPUkNFKQogCiBpZihPU19EQVJXSU4pCg==
" | base64 -d > $TMP/CVE-2017-8366.patch
patch -p1 -i $TMP/CVE-2017-8366.patch
fi

# Configuramos paquete
echo ""
echo "$VERDE"Configurando ..."$CIERRE"
sleep 1
mkdir -p build
cd build
  cmake \
    -DCMAKE_C_FLAGS:STRING="$SLKCFLAGS" \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DLIB_SUFFIX=${LIBDIRSUFFIX} \
    -DMAN_INSTALLDIR=/usr/man \
    -DBUNDLED_LIBS=OFF \
    -DCMAKE_BUILD_TYPE=Release ..
    
echo ""
echo "$VERDE"Compilamos ..."$CIERRE"
sleep 1
  make  || exit 1
  make install DESTDIR=$PKG || exit 1
cd ..

# Creamos un nuevo desktop
mkdir -p $PKG/usr/share/applications/wifislax/Redes
rm -rf $PKG/usr/share/pixmaps/$PRGNAM.svg
rm -f $PKG/usr/share/applications/$PRGNAM.desktop 
cp -rf $PKG/usr/share/$PRGNAM/$PRGNAM.png $PKG/usr/share/pixmaps/$PRGNAM-gtk.png
echo "[Desktop Entry]
Name=Ettercap GTK
Comment=Nework sniffer/analyser
Exec=ettercap-pkexec -G
Icon=ettercap-gtk
Terminal=false
Type=Application
Categories=Redes" > $PKG/usr/share/applications/wifislax/Redes/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos conexion a Internet
f_comprobarConexion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
# Comprobar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Preparamos entrono
f_preparar
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales